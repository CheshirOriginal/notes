Внешнее соединение может быть трёх типов: левое (LEFT), правое (RIGHT) и полное (FULL). По умолчанию оно является полным.

Главным отличием внешнего соединения от внутреннего является то, что оно обязательно возвращает все строки одной (LEFT, RIGHT) или двух таблиц (FULL).
## Внешнее левое соединение (LEFT OUTER JOIN)

Соединение, которое возвращает все значения из левой таблицы, соединённые с соответствующими значениями из правой таблицы, если они удовлетворяют условию соединения, или заменяет их на NULL в обратном случае.

Для примера получим из базы данных расписание звонков, объединённых с соответствующими занятиями в расписании занятий.

![[Pasted image 20251031154404.png]]

Данные в таблице Timepair (расписание звонков):

|id|start_pair|end_pair|
|---|---|---|
|1|08:30:00|09:15:00|
|2|09:20:00|10:05:00|
|3|10:15:00|11:00:00|
|4|11:05:00|11:50:00|
|5|12:50:00|13:35:00|
|6|13:40:00|14:25:00|
|7|14:35:00|15:20:00|
|8|15:25:00|16:10:00|

Данные в таблице Schedule (расписание занятий):

| id  | date                     | class | number_pair | teacher | subject | classroom |
| --- | ------------------------ | ----- | ----------- | ------- | ------- | --------- |
| 1   | 2019-09-01T00:00:00.000Z | 9     | 1           | 11      | 1       | 47        |
| 2   | 2019-09-01T00:00:00.000Z | 9     | 2           | 8       | 2       | 13        |
| 3   | 2019-09-01T00:00:00.000Z | 9     | 3           | 4       | 3       | 13        |
| 4   | 2019-09-02T00:00:00.000Z | 9     | 1           | 4       | 3       | 13        |
| 5   | 2019-09-02T00:00:00.000Z | 9     | 2           | 2       | 4       | 34        |
| 6   | 2019-09-02T00:00:00.000Z | 9     | 3           | 6       | 5       | 35        |
| 7   | 2019-09-03T00:00:00.000Z | 9     | 1           | 5       | 6       | 36        |
| 8   | 2019-09-03T00:00:00.000Z | 9     | 2           | 13      | 7       | 37        |
| 9   | 2019-09-03T00:00:00.000Z | 9     | 3           | 6       | 8       | 38        |
| ... | ...                      | ...   | ...         | ...     | ...     | ...       |

```sql
SELECT Timepair.id "timepair.id", start_pair, end_pair,
    Schedule.id "schedule.id", date, class, number_pair, teacher, subject, classroom
FROM Timepair
    LEFT JOIN Schedule ON Schedule.number_pair = Timepair.id;
```

|timepair.id|start_pair|end_pair|schedule.id|date|class|number_pair|teacher|subject|classroom|
|---|---|---|---|---|---|---|---|---|---|
|1|08:30:00|09:15:00|35|2019-09-04T00:00:00.000Z|8|1|1|11|4|
|1|08:30:00|09:15:00|32|2019-09-03T00:00:00.000Z|8|1|10|10|40|
|1|08:30:00|09:15:00|21|2019-08-30T00:00:00.000Z|8|1|7|9|53|
|1|08:30:00|09:15:00|16|2019-08-30T00:00:00.000Z|9|1|2|4|34|
|1|08:30:00|09:15:00|13|2019-09-05T00:00:00.000Z|9|1|3|13|43|
|1|08:30:00|09:15:00|10|2019-09-04T00:00:00.000Z|9|1|9|9|39|
|1|08:30:00|09:15:00|7|2019-09-03T00:00:00.000Z|9|1|5|6|36|
|1|08:30:00|09:15:00|4|2019-09-02T00:00:00.000Z|9|1|4|3|13|
|1|08:30:00|09:15:00|1|2019-09-01T00:00:00.000Z|9|1|11|1|47|
|2|09:20:00|10:05:00|40|2019-09-05T00:00:00.000Z|8|2|11|1|43|
|2|09:20:00|10:05:00|36|2019-09-04T00:00:00.000Z|8|2|1|12|42|
|2|09:20:00|10:05:00|33|2019-09-03T00:00:00.000Z|8|2|7|9|53|
|2|09:20:00|10:05:00|26|2019-09-01T00:00:00.000Z|8|2|2|4|34|
|2|09:20:00|10:05:00|22|2019-08-30T00:00:00.000Z|8|2|7|9|53|
|2|09:20:00|10:05:00|17|2019-08-30T00:00:00.000Z|9|2|8|2|13|
|2|09:20:00|10:05:00|14|2019-09-05T00:00:00.000Z|9|2|11|1|47|
|2|09:20:00|10:05:00|11|2019-09-04T00:00:00.000Z|9|2|10|10|40|
|2|09:20:00|10:05:00|8|2019-09-03T00:00:00.000Z|9|2|13|7|37|
|2|09:20:00|10:05:00|5|2019-09-02T00:00:00.000Z|9|2|2|4|34|
|2|09:20:00|10:05:00|2|2019-09-01T00:00:00.000Z|9|2|8|2|13|
|3|10:15:00|11:00:00|37|2019-09-04T00:00:00.000Z|8|3|3|13|43|
|3|10:15:00|11:00:00|34|2019-09-03T00:00:00.000Z|8|3|7|9|53|
|3|10:15:00|11:00:00|30|2019-09-02T00:00:00.000Z|8|3|6|8|38|
|3|10:15:00|11:00:00|27|2019-09-01T00:00:00.000Z|8|3|6|5|35|
|3|10:15:00|11:00:00|23|2019-08-30T00:00:00.000Z|8|3|8|2|38|
|3|10:15:00|11:00:00|18|2019-08-30T00:00:00.000Z|9|3|6|5|35|
|3|10:15:00|11:00:00|15|2019-09-05T00:00:00.000Z|9|3|5|6|36|
|3|10:15:00|11:00:00|12|2019-09-04T00:00:00.000Z|9|3|3|11|41|
|3|10:15:00|11:00:00|9|2019-09-03T00:00:00.000Z|9|3|6|8|38|
|3|10:15:00|11:00:00|6|2019-09-02T00:00:00.000Z|9|3|6|5|35|
|3|10:15:00|11:00:00|3|2019-09-01T00:00:00.000Z|9|3|4|3|13|
|4|11:05:00|11:50:00|38|2019-09-04T00:00:00.000Z|8|4|8|2|42|
|4|11:05:00|11:50:00|31|2019-09-02T00:00:00.000Z|8|4|7|9|53|
|4|11:05:00|11:50:00|28|2019-09-01T00:00:00.000Z|8|4|12|6|36|
|4|11:05:00|11:50:00|24|2019-08-30T00:00:00.000Z|8|4|11|1|43|
|4|11:05:00|11:50:00|20|2019-09-03T00:00:00.000Z|9|4|10|10|40|
|4|11:05:00|11:50:00|19|2019-08-30T00:00:00.000Z|9|4|10|1|47|
|5|12:50:00|13:35:00|39|2019-09-04T00:00:00.000Z|8|5|11|1|43|
|5|12:50:00|13:35:00|29|2019-09-01T00:00:00.000Z|8|5|13|7|37|
|5|12:50:00|13:35:00|25|2019-08-30T00:00:00.000Z|8|5|8|3|39|
|6|13:40:00|14:25:00|<NULL>|<NULL>|<NULL>|<NULL>|<NULL>|<NULL>|<NULL>|
|7|14:35:00|15:20:00|<NULL>|<NULL>|<NULL>|<NULL>|<NULL>|<NULL>|<NULL>|
|8|15:25:00|16:10:00|<NULL>|<NULL>|<NULL>|<NULL>|<NULL>|<NULL>|<NULL>|

В выборку попали все строки из левой таблицы, дополненные данными о занятиях. Примечательно, что в конце таблицы есть строки с полями, заполненными NULL. Это те строки, для которых не нашлось соответствующих занятий, однако они присутствуют в левой таблице, поэтому тоже были выведены.
## Внешнее правое соединение

Соединение, которое возвращает все значения из правой таблицы, соединённые с соответствующими значениями из левой таблицы, если они удовлетворяют условию соединения, или заменяет их на NULL в обратном случае.

## Внешнее полное соединение (FULL OUTER JOIN)

Соединение, которое выполняет внутреннее соединение записей и дополняет их левым внешним соединением и правым внешним соединением.

Алгоритм работы полного соединения:

- Формируется таблица на основе внутреннего соединения (INNER JOIN)
- В таблицу добавляются значения, не вошедшие в результат формирования из левой таблицы (LEFT OUTER JOIN)
- В таблицу добавляются значения, не вошедшие в результат формирования из правой таблицы (RIGHT OUTER JOIN)

## Базовые запросы для разных вариантов объединения таблиц

![[Pasted image 20251031154833.png]]

Получение всех данных из левой таблицы, соединённых с соответствующими данными из правой:

```sql
SELECT поля_таблиц 
FROM левая_таблица LEFT JOIN правая_таблица 
    ON правая_таблица.ключ = левая_таблица.ключ 
```

![[Pasted image 20251031154912.png]]

Получение всех данных из правой таблицы, соединённых с соответствующими данными из левой:

```sql
SELECT поля_таблиц
FROM левая_таблица RIGHT JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
```

![[Pasted image 20251031155055.png]]

Получение данных, относящихся только к левой таблице:

```sql
SELECT поля_таблиц
FROM левая_таблица LEFT JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
WHERE правая_таблица.ключ IS NULL
```

![[Pasted image 20251031155131.png]]
Получение данных, относящихся только к правой таблице:

```sql
SELECT поля_таблиц
FROM левая_таблица RIGHT JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
WHERE левая_таблица.ключ IS NULL
```

![[Pasted image 20251031155148.png]]

Получение данных, относящихся как к левой, так и к правой таблице:

```sql
SELECT поля_таблиц
FROM левая_таблица INNER JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
```

![[Pasted image 20251031155244.png]]

Получение всех данных, относящихся к левой и правой таблицам, а также их внутреннему соединению:

```sql
SELECT поля_таблиц
FROM левая_таблица
    FULL OUTER JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
```

![[Pasted image 20251031155304.png]]

Получение данных, не относящихся к левой и правой таблицам одновременно (обратное INNER JOIN):

```sql
SELECT поля_таблиц
FROM левая_таблица
    FULL OUTER JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
WHERE левая_таблица.ключ IS NULL
    OR правая_таблица.ключ IS NULL
```

